## なんか上手くいかないとこ、直したいとことかのメモ

いまいちどうするべきかはっきり決められなかったこととか、途中からこうすればよかったな～って思ってるところ

## ディレクトリ構成、コンポーネント設計

- ディレクトリ構成
  - https://zenn.dev/yoshiko/articles/99f8047555f700 これが自分が考えてたのと大体一緒だった。 `Hoge.page.tsx` みたいなファイル名にするところは確かにそのほうが分かりやすい感あって真似した
- コンポーネント設計
  - `Component(Viewのみ)`, `Container(データ取得とかロジックとかもってComponentに渡す)` という感じで書いていたけど、Container のロジックだけテストしたかったらできないよね？って感じた
    - ロジック部分は `Hoge.hook.ts` みたいにフックに切り出したほうがいいかもと思った。それで Container でフック呼んで Component に渡す感じ
- Concurrent Mode... Suspense とか
  - 途中からやろうと思ったけど `useSWR` の対応が微妙っぽかった（なんかオプションで指定できたけど data の型が optional のままでどうすればいい？ってなった記憶がある）

## SWR

- `React Query` とどっち使うか悩んで、大した差がなさそうなのと Vercel 制なところ（Next.js とか Vercel との親和性とかあるかも？という期待）、サイズが小さいからとかで選んだけど、実装しながら RQ のこと調べてたらそっちのほうが良さそうな気がしてきた
  - キャッシュの更新(mutate)が RQ のほうが便利そうだった
    - 改めて調べたけど大きな違いは DevTool があることくらいっぽかった。次なんかの機会に試してみる

### ルーティング回り

- （できるだけ）型安全にしたい
  - 自分で書いたけど限界がある、プロダクトでやるのは怖い
  - pathpaida？とか使うほうがよさそう
- id カラム以外をルーティングのクエリにするとめんどくさいしなんかデータ取得の時とか無駄なコストかかってそう
  - `/users/[userName]/posts` みたいにしてるところ
  - もちろん `userName` は unique にしてるけど、例えば user.posts を取ってくるときは `where: {userId}` じゃなくて `where: {user: {userName} }` のように一回 user を経由しないといけない

### API Routes

- REST めんどくさい
- 各エンドポイントの返すデータの型はユースケースに依存する = エンドポイントとデータ型は一対一対応
  - どこに定義するべき？
    - API Routes ファイル内に定義する？
      - 1 対 1 を意識できるけど型定義が散らばるのはなんか嫌
    - どこかで API Routes のパスとレスポンスデータの型を集中して管理する
      - できるならこれがいいけど、パス(string)と型を紐づける方法...
      - ちょうどやりたかったことをやっていた https://zenn.dev/takepepe/articles/nextjs-typesafe-api-routes

### Prisma

- 中間テーブルあるときなんかめんどくさい. user が follower, following（どっちも user モデル）を持つときみたいな。 User: {id: string, followers: User[]} みたいな形でとれないの？
  - 自分で成形すればいいけどめんどくさい
  - implicit でやると勝手にやってくれるけど、中間テーブルに情報欲しかったらできない
    - 後から中間テーブルに情報欲しくなる可能性とか普通にありそうなのにマイグレーション融通利かなさそうなのはどうなのか
- authorize どうやるのがいいかよくわからんかった。そもそも prisma の責任の範疇じゃないと思うけど。

### ChakraUI

- 基本的にはいい感じ
- theme をカスタマイズしたときに、props の型にそれが反映されて欲しい
  - declaration merging でできそう。やってないけど
- オリジナル UI コンポーネント作ったとき（例えば Card とか）その theme（baseStyle）をどこに定義するのがよさそうか
  - Card.tsx 側に定義して theme に渡す？
    - （インターフェース的な意味で）Chakra に依存してる感が強いのが微妙な気がする
      - 割り切って依存した方が楽なら開発効率的にはそのほうがいいので何を優先するか問題
    - Card, Panle みたいな利用頻度の高そうなベースコンポーネントは theme にいれてもよさそう
    - UI コンポーネント全部これでやるのは多分めんどくさいし theme がどんどん肥大化する。どこまでやるか問題
  - Card.tsx 内で Chakra 提供フックス使ってスタイリングする
    - コンポーネントのスタイルとかインタフェースをコンポーネント内に閉じれるという意味ではよさそう
    - ダークモード対応はこれだけでやるのは結構めんどい
